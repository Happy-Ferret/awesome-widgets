sudo: required

arch:
    packages:
        - plasma-framework
        # build deps
        - cmake
        - extra-cmake-modules
        - python
        # test
        - xorg-server-xvfb
    script:
        - export DISPLAY=:99.0
        - git clone https://github.com/arcan1s/awesome-widgets/
        - cd awesome-widgets && git submodule update --init --recursive
        - mkdir awesome-widgets/build
        - cd awesome-widgets/build && cmake -DKDE_INSTALL_USE_QT_SYS_PATHS=ON -DCMAKE_BUILD_TYPE=Optimization -DCMAKE_INSTALL_PREFIX=/usr -DBUILD_FUTURE=ON -DBUILD_TESTING=ON ../sources
        - cd awesome-widgets/build && make
        - cd awesome-widgets/build && xvfb-run make test || true
        - cd awesome-widgets/build && xvfb-run ./test/awesomewidgets-test-extscript || true
        - cd awesome-widgets/build && xvfb-run ./test/awesomewidgets-test-extweather || true
        - cd awesome-widgets/build && xvfb-run ./test/awesomewidgets-test-playersource || true
        - cd awesome-widgets/build && xvfb-run ./test/awesomewidgets-test-awkeys || true
        - cd awesome-widgets/build && xvfb-run ./test/awesomewidgets-test-dpplugin || true

script:
    - "curl -s https://raw.githubusercontent.com/mikkeloscar/arch-travis/master/arch-travis.sh | bash"
